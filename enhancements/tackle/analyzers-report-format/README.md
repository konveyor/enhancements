---
title: analyzers-report-format
authors:
  - "@pranavgaikwad"
reviewers:
  - "@jortel"
  - "@fabianvf"
  - "@shawn-hurley"
approvers:
  - "@jortel"
  - "@fabianvf"
  - "@shawn-hurley"
creation-date: 2022-09-27
last-updated: 2022-09-28
status: provisional
see-also:
  - "N/A"  
replaces:
  - "N/A"
superseded-by:
  - "N/A"
---

# Analyzers Report Format

Konveyor will run different addons to perform different tasks in the modernization workflow. Analyzers are one example of addons that take a set of rules & source code / binary as input, analyze the source code / binary and return violations of those rules as output. The output is a violation report that helps Konveyor take further actions such as generating reports, creating project management tasks, etc. This document proposes a format for the output of analyzer addons.

## Release Signoff Checklist

- [x] Enhancement is `implementable`
- [ ] Design details are appropriately documented from clear requirements
- [ ] Test plan is defined
- [ ] User-facing documentation is created

## Summary

Addons will be executed via Konveyor Hub for source code analysis, binary analysis and more. The output of addons is crucial. It will be used by Konveyor to take further actions such as creating project management tasks, providing recommendations and remediations, among others. Since addons will be implemented for different purposes, they will perform different tasks. This enhancement only applies to analyzer addons. Since analyzers can be implemented for various different technologies, they all will work differently internally. However, all analyzer addons will be working towards a common goal in the modernization workflow. Therefore, it is important for them to have a common output format. A common format will ensure that the analyzer addons integrate with Konveyor Hub seamlessly.

### Goals

- Propose a machine readable output format for analyzer addons

### Non-Goals

- Design APIs for serving the output
- Propose data store to persist output
- Propose integration details

## Proposal

The analyzer addons will follow a common format for their output. It can be represented as JSON or YAML. Konveyor will expect some common fields from every addon. These fields will assist konveyor create project management tasks. Based on capabilities of the addon, the addon can also add more fields. The format will thus have some common fields and some extra fields left for additional output of the addon. The additional output can potentially be OpenAPI spec.

### Output Format

#### Violations

Every addon will return a list of violations in their output. Each violation will be:

```golang

type Violation struct {
	// Description text description about the violation
	Description string `yaml:"description"`

	// Category category of the violation
	Category *Category `yaml:"category,omitempty"`

	// Labels labels on the rule
	Labels []string `yaml:"labels,omitempty"`

	// Incidents list of instances of violation found
	Incidents []Incident `yaml:"incidents"`

	// ExternalLinks hyperlinks to external sources of docs, fixes
	Links []Link `yaml:"links,omitempty"`

	// Extras reserved for additional data
	Extras json.RawMessage

	// Effort is a numeric value denoting level of effort needed to fix one occurrence of this issue
	Effort *int `yaml:"effort,omitempty"`
}

// Incident defines instance of a violation
type Incident struct {
    // URI defines location in the codebase where violation is found
    URI           string    `json:"uri"`
    // Message text description about the incident
    Message       string    `json:"message"`
    // Extras reserved for additional data
    Extras        json.RawMessage
}

// Link defines an external hyperlink
type Link struct {
    URL           string   `json:"url"`
    // Title optional description
    Title         string   `json:"title,omitempty"`
}
```

* `Description`: Text description about the violation copied from Rule. The rule authors need to provide a text description that helps understand the issue.

* `Category`: Category of the violation as defined by the rule. e.g. mandatory, potential, etc.

* `Labels`: Additional labels defined in the rule. They help search, filter the violations.

* `Effort`: Numeric value inherited from the rule. It indicates the level of effort needed to fix this issue.

* `Incidents`: List of occurrences of this issue within the source code.

* `Links`: List of hyperlinks that point to additional external resources about the issue.

* `Extras`: Reserved field to convey any extra information generated by the analyzer that doesn't fit in above fields.

#### Ruleset

The _Violations_ will be generated per _Ruleset_:

```go
type Ruleset struct {
	Name        string               `yaml:"name,omitempty"`
	Description string               `yaml:"description,omitempty"`
	Source      *RuleSetTechnology   `yaml:"source,omitempty"`
	Target      *RuleSetTechnology   `yaml:"target,omitempty"`
	Violations map[string]Violation `yaml:"violations,omitempty"`
}
```

Violations are a map where each key is the name of the Rule, with the value being a Violation. Each Rule generates exactly one Violation.

Every report is an array of Rulesets with each ruleset having its violations:

```yaml
- name: ruleset-1
  violations:
    rule1:
      description: rule 1 in ruleset-1
      effort: 0
      category: information
- name: ruleset-2
  violations:
    rule1:
      description: rule 1 in ruleset-2
      effort: 2
      category: mandatory
```

#### Tags

Application tags will also be created per Ruleset:

```go
type Ruleset struct {
	Name        string               `yaml:"name,omitempty"`
	Description string               `yaml:"description,omitempty"`
	Source      *RuleSetTechnology   `yaml:"source,omitempty"`
	Target      *RuleSetTechnology   `yaml:"target,omitempty"`
	Violations  map[string]Violation `yaml:"violations,omitempty"`
  // Tags list of tags generated for the application
	Tags        []string             `yaml:"tags,omitempty"`
}
```

Tags are a list of strings. Each string value will be a comma separated list of tags, optionally, having a category associated for the tags.

```yaml
- [...]
  tags:
  - tag1,tag2
  - Frontend=tag3,tag4
  - Backend=tag4,tag5
```

In the above example, `tag1` and `tag2` tags are uncategorized. On the other hand, `tag3` & `tag4` are categorized (tag type) into `Frontend` and `tag4` & `tag5` are categorized as `Backend` types.

In the overall output, the tags would look something like:

```yaml
- name: ruleset-1
  # tags generated by ruleset 1
  tags:
  - tag1, tag2
  - Frontend=tag3
  violations:
    rule1:
      description: rule 1 in ruleset-1
      effort: 0
      category: information
- name: ruleset-2
  # tags generated by ruleset 2
  tags:
  - tag3, tag4
  - Backend=tag5
  violations:
    rule1:
      description: rule 1 in ruleset-2
      effort: 2
      category: mandatory
```


#### Unmatched and failed rules

The engine can fail to parse or execute a rule. For the rules that were executed, some may match partially or not match at all. In such cases, the engine itself might not fail and continue to run to completion.

For all these cases, there will be additional fields in the Ruleset: 

```go
type Ruleset struct {
	Name        string               `yaml:"name,omitempty"`
	Description string               `yaml:"description,omitempty"`
	Source      *RuleSetTechnology   `yaml:"source,omitempty"`
	Target      *RuleSetTechnology   `yaml:"target,omitempty"`
	Violations  map[string]Violation `yaml:"violations,omitempty"`
	Tags        []string             `yaml:"tags,omitempty"`

  // Errors are the rules that resulted in errors and failed to execute
  // each key in the map is the Rule ID with the error as value
  Errors map[string]error `yaml:"errors,omitempty"`

  // Unmatched are the rules that were not matched
  // list of rules that were executed but not matched
  Unmatched []string `yaml:"unmatched,omitempty"`
}
```
In the overall output, the errors would look something like:


```yaml
- name: ruleset-1
  tags:
  - tag1, tag2
  - Frontend=tag3
  violations:
    rule1:
      description: rule 1 in ruleset-1
      effort: 0
      category: information
  # errors occurred when executing rules
  errors:
    rule2: "failed to parse condition 'or'"
  # unmatched rules
  unmatched:
  - rule3
  - rule4
- name: ruleset-2
  tags:
  - tag3, tag4
  - Backend=tag5
  violations:
    rule1:
      description: rule 1 in ruleset-2
      effort: 2
      category: mandatory
  # errors occurred when executing rules
  errors:
    rule2: "failed to parse condition 'or'"
  # unmatched rules
  unmatched:
  - rule3
  - rule4
```